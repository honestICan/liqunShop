$(function(){function e(){var e=0;c();var i=$.cookie("car");if(i)if(i=JSON.parse(i),$(".list").empty(),i.length>0){for(var t=0;t<i.length;t++){var a=i[t],r=$("<li></li>").appendTo(".list"),n=$("<p></p>").appendTo(r);1==a.ischecked?n.append($('<input type="checkbox" class="select" checked="checked"/>')):n.append($('<input type="checkbox" class="select" />')),n.append("<span>"+a.name+"</span>");var l=$("<div></div>").appendTo(r);l.append($("<img src="+a.img+">")),l.append($("<span>"+a.unit+a.price+"</span>")),l.append($('<input type="button" class="reduce" value="-"/>')),l.append($('<input type="text" class="num" value='+a.num+">")),l.append($('<input type="button" class="add" value="+"/>')),l.append($('<a href="javascript:;" class="delete">删除</a>')),1==a.ischecked&&(e+=a.price*a.num)}$(".allprice").html(e)}else $(".allprice").html(0),alert("购物车是空的");else alert("你啥也没买"),location.href="itemsAll.html"}function c(){if($.cookie("car")){for(var e=JSON.parse($.cookie("car")),c=0,i=0;i<e.length;i++)c+=e[i].ischecked;0!=c&&c==e.length?$(".selectAll").prop("checked",!0):$(".selectAll").prop("checked",!1)}}function i(){var e=parseInt(prompt("请输入金额")),c=prompt("请输入密码");e>=t&&6==c.length?alert("付款成功"):alert("支付失败")}e(),$("#car .go").click(function(){location.href="itemsAll.html"}),$(".list").on("click",".add",function(){var c=$(this).index(".list .add"),i=JSON.parse($.cookie("car"));i[c].num++,$.cookie("car",JSON.stringify(i),{expires:30,path:"/"}),e(),console.log($.cookie("car"))}),$(".list").on("click",".reduce",function(){var c=$(this).index(".list .reduce"),i=JSON.parse($.cookie("car"));i[c].num--,i[c].num<=1&&(i[c].num=1),$.cookie("car",JSON.stringify(i),{expires:30,path:"/"}),e()}),$(".list").on("click",".delete",function(){var i=$(this).index(".list .delete"),t=JSON.parse($.cookie("car"));t.splice(i,1),$.cookie("car",JSON.stringify(t),{expires:30,path:"/"}),c(),e()}),$(".list").on("click",".select",function(){var i=$(this).index(".list .select"),t=JSON.parse($.cookie("car"));t[i].ischecked=!t[i].ischecked,$.cookie("car",JSON.stringify(t),{expires:30,path:"/"}),c(),e()}),$(".selectAll").click(function(){for(var c=JSON.parse($.cookie("car")),i=0;i<c.length;i++)$(this).prop("checked")?c[i].ischecked=!0:c[i].ischecked=!1;$.cookie("car",JSON.stringify(c),{expires:30,path:"/"}),e()}),$(".deleteSelect").click(function(){for(var i=JSON.parse($.cookie("car")),t=[],a=0;a<i.length;a++)0==i[a].ischecked&&t.push(i[a]);$.cookie("car",JSON.stringify(t),{expires:30,path:"/"}),c(),e()});var t=parseInt($(".allprice").html()),a=function(e,c){for(var i=e.split("&"),t=0;t<i.length;t++){var a=i[t].split("=");if(a[0]==c)return a[1]}return""}(location.search.substring(1),"username");$(".sum").click(function(){if(0==a.length)confirm("你未登录,是否登录")&&(location.href="login.html");else{var e=parseInt(prompt("请输入金额")),c=prompt("请输入密码");if(e>=t&&6==c.length)return void alert("付款成功");alert("支付失败"),i()}})});